<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pomo - focus & study timer</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <!-- tailwind css via cdn -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- google fonts for typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@500;700&family=Lato:wght@300;400;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'lato', sans-serif;
            @apply bg-gray-50 text-gray-800 transition-colors duration-300;
        }
        .hero-font {
            font-family: 'oswald', sans-serif;
        }
        .timer-font {
            font-family: 'Roboto Mono', monospace;
        }
        .flat-card {
            @apply bg-white p-6 md:p-8 rounded-2xl shadow-lg border border-gray-200 transition-all duration-300;
        }
        .settings-menu-container {
            transition: max-height 0.5s ease-in-out, padding 0.5s ease-in-out, opacity 0.5s ease-in-out;
            /* Prevents content from being visible outside the max-height boundary */
            overflow: hidden; 
        }
        .settings-menu-container.hidden-menu {
            max-height: 0;
            padding: 0;
            opacity: 0;
            /* Ensures the element does not block clicks when hidden */
            pointer-events: none; 
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4 md:p-8">

    <div class="max-w-lg w-full text-center space-y-8 flex-grow">
        <h1 class="hero-font text-5xl md:text-6xl font-bold tracking-tight">pomo.</h1>
        <p class="text-gray-500 text-sm md:text-base font-light max-w-sm mx-auto">a simple timer for focused work.</p>

        <!-- main timer card -->
        <div class="flat-card">
            <h2 id="timer-mode-title" class="text-lg font-semibold text-gray-600 mb-6">study session</h2>
            
            <div class="text-7xl md:text-8xl font-light tracking-tight mb-8 timer-font">
                <span id="minutes">25</span>:<span id="seconds">00</span>
            </div>
            
            <div class="relative w-full h-2.5 rounded-full bg-gray-200 overflow-hidden mb-6">
                <div id="progress-bar" class="absolute top-0 left-0 h-full bg-green-500 transition-all duration-300 ease-in-out" style="width: 0%;"></div>
            </div>

            <div class="flex items-center justify-center space-x-2 md:space-x-4">
                <button id="reset-button" class="px-4 py-2 bg-white text-gray-500 border border-gray-300 rounded-full text-sm font-medium hover:bg-gray-100 transition-colors transform active:scale-95 active:shadow-inner">reset</button>
                <button id="start-pause-button" class="px-8 py-3 bg-green-500 text-white rounded-full text-lg font-medium shadow-lg hover:bg-green-600 transition-colors transform hover:scale-105 active:scale-95 active:shadow-inner">start</button>
                <button id="settings-button" class="px-4 py-2 bg-white text-gray-500 border border-gray-300 rounded-full text-sm font-medium hover:bg-gray-100 transition-colors transform active:scale-95 active:shadow-inner">settings</button>
            </div>
        </div>

        <!-- customizable settings (now a toggleable menu) -->
        <div id="settings-menu" class="settings-menu-container hidden-menu">
            <div class="flat-card">
                <h3 class="text-lg font-semibold text-gray-600 mb-4">customize times</h3>
                <div class="flex flex-col sm:flex-row items-center justify-center space-y-4 sm:space-y-0 sm:space-x-4 mb-4">
                    <div class="flex flex-col items-start w-full sm:w-1/2">
                        <label for="study-input" class="text-sm font-medium text-gray-500 mb-1">study (min)</label>
                        <input type="number" id="study-input" value="25" min="1" class="w-full text-center p-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-green-500 transition-colors">
                    </div>
                    <div class="flex flex-col items-start w-full sm:w-1/2">
                        <label for="break-input" class="text-sm font-medium text-gray-500 mb-1">break (min)</label>
                        <input type="number" id="break-input" value="5" min="1" class="w-full text-center p-2 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors">
                    </div>
                </div>
                <button id="apply-times-button" class="w-full px-5 py-2.5 bg-gray-200 text-gray-700 rounded-full text-sm font-medium hover:bg-gray-300 transition-colors">apply settings</button>
            </div>
        </div>

        <!-- session streak & affirmation -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
            <div class="flat-card flex flex-col justify-center items-center">
                <h3 class="text-lg font-semibold text-gray-600 mb-2">current streak</h3>
                <span id="streak-count" class="text-5xl font-light">0</span>
            </div>
            <div class="flat-card flex flex-col justify-center items-center text-center">
                <h3 class="text-lg font-semibold text-gray-600 mb-2">quote of the moment</h3>
                <p id="affirmation-quote" class="text-sm italic text-gray-500">
                    "a journey of a thousand miles begins with a single step."
                </p>
            </div>
        </div>
        
    </div>

    <p class="mt-8 text-xs text-gray-400">Made with ❤️ by <a href="https://github.com/arxivius/" target="_blank" rel="noopener noreferrer" class="font-bold underline hover:text-gray-600">arXiVius</a></p>

    <!-- Tone.js for sound effects -->
    <script src="https://unpkg.com/tone@14.7.58/build/Tone.js"></script>

    <script>
        // --- DOM Element References ---
        const minutesEl = document.getElementById('minutes');
        const secondsEl = document.getElementById('seconds');
        const startPauseButton = document.getElementById('start-pause-button');
        const resetButton = document.getElementById('reset-button');
        const timerModeTitle = document.getElementById('timer-mode-title');
        const progressBar = document.getElementById('progress-bar');
        const studyInput = document.getElementById('study-input');
        const breakInput = document.getElementById('break-input');
        const applyTimesButton = document.getElementById('apply-times-button');
        const settingsButton = document.getElementById('settings-button');
        const settingsMenu = document.getElementById('settings-menu');
        const streakCountEl = document.getElementById('streak-count');
        
        // --- State Variables ---
        let timerInterval;
        let isPaused = true;
        let studyTime = 25 * 60; // 25 minutes in seconds
        let breakTime = 5 * 60; // 5 minutes in seconds
        let totalTime; // Total time for the current session
        let timeRemaining; // Time remaining in the current session
        let currentMode = 'study';
        let streakCount = 0;

        // --- Sound Generator ---
        // Create a simple synth for the timer completion sound
        const synth = new Tone.Synth().toDestination();
        const playDing = () => {
            // Play a note for a short duration
            synth.triggerAttackRelease('C4', '8n');
        };

        // --- Core Timer Functions ---

        /**
         * Updates the timer display (minutes, seconds) and the progress bar.
         */
        function updateDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;

            minutesEl.textContent = String(minutes).padStart(2, '0');
            secondsEl.textContent = String(seconds).padStart(2, '0');
            
            // Calculate and update the progress bar width
            const progress = ((totalTime - timeRemaining) / totalTime) * 100;
            progressBar.style.width = `${progress}%`;
            
            // Update the progress bar color based on the current mode
            if (currentMode === 'study') {
                progressBar.classList.remove('bg-blue-500');
                progressBar.classList.add('bg-green-500');
            } else {
                progressBar.classList.remove('bg-green-500');
                progressBar.classList.add('bg-blue-500');
            }
        }

        /**
         * Sets the initial state for the timer based on the current mode.
         */
        function setInitialTime() {
            if (currentMode === 'study') {
                timeRemaining = studyTime;
                totalTime = studyTime;
                timerModeTitle.textContent = 'study session';
            } else {
                timeRemaining = breakTime;
                totalTime = breakTime;
                timerModeTitle.textContent = 'break time';
            }
            updateDisplay();
        }

        /**
         * Starts or resumes the timer.
         */
        function startTimer() {
            if (!isPaused) return; // Already running
            isPaused = false;
            startPauseButton.textContent = 'pause';
            // Change button color to red for pause state
            startPauseButton.classList.remove('bg-green-500', 'hover:bg-green-600');
            startPauseButton.classList.add('bg-red-500', 'hover:bg-red-600');

            timerInterval = setInterval(() => {
                if (timeRemaining > 0) {
                    timeRemaining--;
                    updateDisplay();
                } else {
                    // Timer has ended
                    clearInterval(timerInterval);
                    endSession();
                }
            }, 1000);
        }

        /**
         * Pauses the timer.
         */
        function pauseTimer() {
            if (isPaused) return; // Already paused
            isPaused = true;
            clearInterval(timerInterval);
            startPauseButton.textContent = 'start';
            // Change button color to green for start state
            startPauseButton.classList.remove('bg-red-500', 'hover:bg-red-600');
            startPauseButton.classList.add('bg-green-500', 'hover:bg-green-600');
        }

        /**
         * Toggles the timer between start and pause states.
         */
        function toggleTimer() {
            if (isPaused) {
                startTimer();
            } else {
                pauseTimer();
            }
        }

        /**
         * Resets the timer to the beginning of the current session.
         */
        function resetTimer() {
            pauseTimer();
            setInitialTime();
        }

        /**
         * Handles the end of a timer session, switching modes and playing a sound.
         */
        function endSession() {
            playDing();
            if (currentMode === 'study') {
                currentMode = 'break';
                streakCount++;
                streakCountEl.textContent = streakCount;
            } else {
                currentMode = 'study';
            }
            setInitialTime();
        }

        // --- Event Listeners ---

        // Start/Pause button functionality
        startPauseButton.addEventListener('click', toggleTimer);

        // Reset button functionality
        resetButton.addEventListener('click', () => {
            // If the timer is running, pause and reset
            if (!isPaused) {
                pauseTimer();
            }
            // Switch back to the study mode and reset streak
            currentMode = 'study';
            streakCount = 0;
            streakCountEl.textContent = streakCount;
            setInitialTime();
        });

        // Apply settings button functionality
        applyTimesButton.addEventListener('click', () => {
            const newStudyTime = parseInt(studyInput.value, 10);
            const newBreakTime = parseInt(breakInput.value, 10);

            if (newStudyTime > 0 && newBreakTime > 0) {
                studyTime = newStudyTime * 60;
                breakTime = newBreakTime * 60;

                // If the current mode is study, update the timer immediately
                if (currentMode === 'study') {
                    pauseTimer();
                    setInitialTime();
                }
                
                // Hide the settings menu after applying
                settingsMenu.classList.add('hidden-menu');
            } else {
                // Use a custom message box instead of alert()
                const errorMessage = "Please enter valid times (greater than 0).";
                const messageBox = document.createElement('div');
                messageBox.className = 'absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-red-100 border-2 border-red-500 text-red-700 p-4 rounded-lg shadow-xl';
                messageBox.innerHTML = `<p class="font-bold">${errorMessage}</p><button class="mt-2 text-sm underline" onclick="this.parentElement.remove()">Dismiss</button>`;
                document.body.appendChild(messageBox);
            }
        });
        
        // Toggle settings menu button functionality
        settingsButton.addEventListener('click', () => {
            settingsMenu.classList.toggle('hidden-menu');
        });

        // --- Initial Setup ---
        // Set the initial timer state
        setInitialTime();
    </script>
</body>
</html>

